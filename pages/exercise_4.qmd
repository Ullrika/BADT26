---
title: "Exercise 4"
subtitle: "DABT26"
author: "Zheng Zhou"
---

## MCMC sampling software

(@) Gibbs sampling and BUGS

- Strength: Simple coding and similar to basic Metropolis algorithm

- Weakness: Really random walks, poor at dealing with complex problems

(@) Hamilton MC and stan

- Strength: Uses gradient information to explore high-dimensional, correlated parameter space more efficiently

- Weakness: Requires more coding efforts

## Stan ecosystem

(@) sampler: rstan, cmdstanr, PyStan

(@) high-level utility package: rstanarm, brms, PyStan and more

## Getting start with Stan

(@) Installation

Use R: install [cmdstanr](https://mc-stan.org/cmdstanr/)

1. install [Rtools45](https://github.com/r-hub/rtools45/releases/download/latest/rtools45.exe)

2. install cmdstanr

3. build cmdstan

Use python: install [PyStan](https://pystan.readthedocs.io/en/latest/installation.html)

(@) Once done, run an example model to check the compiler

(@) Extract model diagnostics

```{r}
# install.package(c("bayesplot","tidyverse","posterior))

library(bayesplot)
library(posterior)
library(tidyverse)
```

Check rhat and effecti sample size:

```{r}
# all parameters
# fit$summary()
```

Rhat should be as close to 1 as possible

ESS: ideally number of sampling steps from all chains

Traceplot:

```{r}
# all parameters
# mcmc_trace(fit$draws())

# specific parameter
# mcmc_trace(fit$draws("theta"))
```

Autocorrelation:

```{r}
# all parameters
# mcmc_acf(fit$draws())
```

When something goes wrong, check [this](https://mc-stan.org/docs/reference-manual/analysis.html)
